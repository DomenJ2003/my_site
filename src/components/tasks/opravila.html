<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TASKS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>

    <style>
        .content{
            height: 400px;
            overflow-y: hidden;
        }
    </style>

</head>

<body>
  <div style="max-height: 400px;">
    <div class="row justify-content-center">
      <h1 class="col-md-12 bg-primary text-center p-2 ">TASKS</h1>
  </div>
  <div class="row justify-content-center content">
      <div class="col-md-4 p-3">
          <div class="kategorija-vnos-vrstica">
              <form onsubmit="return false">
                  <div class="input-group">
                      <input type="text" name="vnos-kategorije" id="vnos-kategorije" class="form-control" />
                      <div class="input-group-btn">
                          <button class="dodaj-kategorijo btn btn-primary ms-2">Add</button>
                          <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#kategorija-modal">
                              Delete
                          </button>
                      </div>
                  </div>
              </form>
          </div>
          <ul class="kategorije-seznam list-group mt-3"></ul>
      </div>
      <div class="col-md-4 p-3">
          <div class="opravila-vnosna-vrstica">
              <div class="input-group">
                  <input type="text" name="vnos-opravila" id="vnos-opravila" class="form-control" />
                  <div class="input-group-btn">
                      <button class="dodaj-opravilo btn btn-primary ms-2">Add</button>
                      <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#opravila-modal">Delete</button>
                  </div>
              </div>
          </div>
          <table class="table table-striped mt-2 ">
              <thead>
                  <tr>
                      <th>#</th>
                      <th>Description</th>
                      <th>Category</th>
                      <th>Date</th>
                  </tr>
              </thead>
              <tbody class="tabela-opravil"></tbody>
          </table>
          
      </div>
  </div>
  <div class="row justify-content-center">
      <div class="col-md-10 bg-secondary text-center p-2">Tasks app with jQuery, Bootstrap and localStorage</div>
  </div>
  </div>
    
<!-- Modalno okno -->
    <div class="modal fade" id="opravila-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Warning</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the selected tasks?
            </div>
            <div class="modal-footer">
              <button type="button" id="izbrisi-opravilo" class="btn btn-danger"  data-bs-dismiss="modal">Delete</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal fade" id="kategorija-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">Warning</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the selected category?
            </div>
            <div class="modal-footer">
              <button type="button" id="izbrisi-kategorijo" class="btn btn-danger" data-bs-dismiss="modal">Delete</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
          </div>
        </div>
      </div>
      <script>
        getTime=()=>{
    let hour = new Date().getHours();
    if(hour<10){
        hour = '0'+hour
    }
    let min = new Date().getMinutes();
    if(min <10){
        min = '0'+min;
    }
    return ` ${hour}:${min}`
}

preveriEnakostKategorij=(elementi)=>{
    let jeRazlicno = true;
    elementi.forEach(el=>{ 
        el = el.replace('<li class="kategorija list-group-item">', '');
        el = el.replace('</li>', '');
        if(el == $('#vnos-kategorije').val()){
            jeRazlicno = false;
        }
    })
    return jeRazlicno;
}

$(document).ready(function () {

    var izbranaKategorija;
    var izbranaOpravila = [];
    var vseKategorije = localStorage.getItem('vseKategorije') ? localStorage.getItem('vseKategorije').split(','): [
        '<li class="kategorija list-group-item">Task</li>',
        '<li class="kategorija list-group-item">Project</li>',
        '<li class="kategorija list-group-item">Category 3</li>',
    ];
    var vsaOpravila = localStorage.getItem('vsaOpravila') ? localStorage.getItem('vsaOpravila').split(','): [

    ];
    var stevec= localStorage.getItem('stevec') ? parseInt(localStorage.getItem('stevec')): 0;
    if(vsaOpravila.length == 0){
        stevec = 0;
        localStorage.setItem('stevec', stevec.toString());
    }

    for(kategorija of vseKategorije){
        $('.kategorije-seznam').html(
            $('.kategorije-seznam').html()+
            kategorija
        );
        localStorage.setItem('vseKategorije', vseKategorije);
    }

    for(opravilo of vsaOpravila){
        $('.tabela-opravil').html(
            $('.tabela-opravil').html()+
            opravilo
        );
    }


    $(".dodaj-kategorijo").click(function (e) { 
        e.preventDefault();
        if($('#vnos-kategorije').val().length != 0 && preveriEnakostKategorij(vseKategorije)){
            $('.kategorije-seznam').html(
                $('.kategorije-seznam').html()+
                `<li class="kategorija list-group-item">${$('#vnos-kategorije').val()}</li>`
            );
            vseKategorije.push(`<li class="kategorija list-group-item">${$('#vnos-kategorije').val()}</li>`);
            localStorage.setItem('vseKategorije', vseKategorije)
            $('#vnos-kategorije').val('');

        }else if($('#vnos-kategorije').val().length == 0){
            alert('The category name cannot be empty');
        }else{
            alert('You already have that category');
            $('#vnos-kategorije').val('');
        }

    });
    $(".dodaj-opravilo").click(function (e) { 
        e.preventDefault();
        if($('#vnos-opravila').val().length != 0 && izbranaKategorija !== undefined){
            stevec++;
            localStorage.setItem('stevec', stevec.toString());
            vsaOpravila.push(
                '<tr class="opravilo">'+
                    '<td>'+
                        stevec+
                    '</td>'+
                    '<td>'+
                        $('#vnos-opravila').val()+
                    '</td>'+
                    '<td>'+
                        izbranaKategorija.innerHTML+
                    '</td>'+
                    '<td>'+
                        new Date().toLocaleDateString()+
                        getTime()+
                    '</td>'+
               '</tr>'
            );
            localStorage.setItem('vsaOpravila', vsaOpravila);
            $('.tabela-opravil').html(
                $('.tabela-opravil').html()+
                vsaOpravila[vsaOpravila.length-1]
            );
            
            $('#vnos-opravila').val('');
        }else if($('#vnos-opravila').val().length != 0){
            alert('Category must be selected')
        }else{
            alert('Description cannot be empty')
        }
    });


    $('#izbrisi-kategorijo').click(function (e) { 
        if(izbranaKategorija != undefined){
            e.preventDefault();
            $(izbranaKategorija).removeClass("active");
            vseKategorije= vseKategorije.filter(kategorija =>!kategorija.match(izbranaKategorija.innerHTML));
            izbranaKategorija.remove();
            localStorage.setItem('vseKategorije', vseKategorije);  
        }   
    });

    $('#izbrisi-opravilo').click(function (e) { 
        if(izbranaOpravila != []){
            e.preventDefault();
        izbranaOpravila.map(izbranoOpravilo=>{
            vsaOpravila = vsaOpravila.filter(opravilo => !opravilo.match(izbranoOpravilo.innerHTML))
        })
        localStorage.setItem('vsaOpravila', vsaOpravila);
        for(let opravilo of izbranaOpravila){
            opravilo.remove();
        }
        izbranaOpravila = [];
        if(vsaOpravila.length == 0){
            stevec=0;
            localStorage.setItem('stevec', stevec.toString());
        }
        }
    });

    $(document).on('click', '.kategorija', function() {  
        $('.kategorija').removeClass('active');
        $(this).addClass("active");
        izbranaKategorija = this;
    }); 

    $(document).on('click', '.opravilo', function() { 
        if(this.classList.contains("table-danger")){
            izbranaOpravila.filter(el=>el!==this);
            $(this).removeClass("table-danger");
            
        }else{
            $(this).addClass("table-danger");
            izbranaOpravila.push(this);
        }
        
    }); 

    $('#myModal').on('shown.bs.modal', function () {
        $('#myInput').trigger('focus')
      })
});

      </script>
</body>

</html>